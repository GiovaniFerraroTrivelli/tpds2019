@startuml CU-12

title CU-12: Registrar pago de póliza
center footer Grupo 4A: Matías Bode, Francisco Busso, Giovani Ferraro Trivelli, Miguel Storani

actor Usuario
boundary InterfazUsuario
entity ControladorPoliza
entity GestorPoliza

ref over Usuario, InterfazUsuario, ControladorPoliza, GestorPoliza
    CU-18: Buscar Poliza
end ref

loop do while poliza incorrecta
activate Usuario
Usuario -> InterfazUsuario : Seleccionar poliza
activate InterfazUsuario
InterfazUsuario -> ControladorPoliza : POST numero poliza seleccionada
activate ControladorPoliza
ControladorPoliza -> GestorPoliza : obtenerPoliza(numeroPoliza)
activate GestorPoliza
alt existe la poliza
ControladorPoliza <-- GestorPoliza : Poliza seleccionada
InterfazUsuario <-- ControladorPoliza : JSON datos poliza
Usuario <-- InterfazUsuario : Datos de poliza
else no existe la poliza o no esta vigente
ControladorPoliza <-- GestorPoliza : Mensaje de error "No existe poliza o no esta vigente"
InterfazUsuario <-- ControladorPoliza : JSON Error "No existe poliza o no esta vigente"
Usuario <-- InterfazUsuario : Error 
end
end
loop do while !confirmado
Usuario -> InterfazUsuario : Seleccionar cuotas a abonar
InterfazUsuario -> ControladorPoliza : POST cuotas a abonar
ControladorPoliza -> GestorPoliza : calcularImportes()
ControladorPoliza <-- GestorPoliza : Importes
InterfazUsuario <-- ControladorPoliza : JSON Importes
Usuario <-- InterfazUsuario : Importes parciales y totales
alt la cuota seleccionada no es la primera pendiente de pago
Usuario <-- InterfazUsuario : Error "No puede cancelar una cuota posterior a la primera pendiente de pago"
end
alt el usuario confirma el pago
Usuario -> InterfazUsuario : confirmar pago
else cancelar
Usuario -> InterfazUsuario : cancelar
end
end
Usuario -> InterfazUsuario : Ingresar monto abonado
InterfazUsuario -> ControladorPoliza : POST monto abonado
ControladorPoliza -> GestorPoliza : calcularVuelto()
ControladorPoliza <-- GestorPoliza : Monto vuelto
InterfazUsuario <-- ControladorPoliza : JSON vuelto
Usuario <-- InterfazUsuario : Monto vuelto
GestorPoliza -> GestorPoliza : registrarPago()

ref over Usuario, InterfazUsuario, ControladorPoliza, GestorPoliza
    CU-13: Emitir recibo de pago
end ref

@enduml